<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forms and Runs Interface</title>
  <link rel="stylesheet" href="styles.css"> 
</head>
<body>
  <div class="grid-container">
    <!-- Forms Section -->
    <div class="section form-section">
      <h2>Manage Forms</h2>
      <div>
        <input type="text" id="new-form-name" class="input" placeholder="Enter form name">
        <button class="button" onclick="createForm()">+ Create Form</button>
      </div>
      <ul id="form-list" class="form-list">
        <!-- Forms will be dynamically added here -->
      </ul>
    </div>

    <!-- Runs Section -->
    <div class="section run-section">
      <h2>Run a Form</h2>
      <div>
        <label for="form-select">Select Form:</label>
        <select id="form-select" class="input">
          <option value="">-- Select a Form --</option>
        </select>
      </div>
      <div>
        <label for="folder-select">Select Folder:</label>
        <select id="folder-select" class="input">
          <option value="">-- Select a Folder --</option>
        </select>
      </div>
      <button class="button" onclick="runForm()">Run Form on Folder</button>
    </div>

    <!-- Folder Management Section -->
    <div class="section folder-section">
      <h2>Manage Folders</h2>
      <!-- Create Folder -->
      <div>
        <input type="text" id="new-folder-name" class="input" placeholder="Enter folder name">
        <button class="button" onclick="createFolder()">+ Create Folder</button>
      </div>

      <!-- Upload File -->
      <div>
        <select id="folder-select-upload" class="input">
          <option value="">-- Select a Folder --</option>
        </select>
        <input type="file" id="file-input" class="input">
        <button class="button" onclick="uploadFile()">Upload File</button>
      </div>

      <!-- File List -->
      <div>
        <h3>Files in Selected Folder</h3>
        <table id="file-table" style="width: 100%;">
          <thead>
            <tr>
              <th style="width: 33%;">File Name</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <!-- Rows will be dynamically inserted here -->
          </tbody>
        </table>
        
      </div>
      
    </div>
    <!-- Latest Run Output Section (Fourth Quadrant) -->
    <div class="section latest-run-section">
      <h2>Latest Run Output</h2>
      <div id="latest-run-output">
        <!-- This will be dynamically populated with the latest run's result -->
        <p>Select a form and folder to see the latest run output here.</p>
      </div>
    </div>

  </div>



  <script src="forms.js"></script> 
  <script src="folders.js"></script> <!-- Link to the JavaScript file -->
  <script src="runs_retrieve.js"></script> <!-- Link to the JavaScript file -->
  
  <script>

    async function runForm() {
      const formUuid = document.getElementById('form-select').value;
      const folderUuid = document.getElementById('folder-select').value;
      const runUuid = generateUUID(); // Assuming you have this utility function

      if (!formUuid || !folderUuid) {
          alert("Please select both form and folder.");
          return;
      }

      // Construct the URL with query parameters
      const url = `http://localhost:8001/rag_on_form?form_uuid=${encodeURIComponent(formUuid)}&folder_uuid=${encodeURIComponent(folderUuid)}&run_uuid=${encodeURIComponent(runUuid)}`;

      console.log("Sending request to URL:", url);

      try {
          const response = await fetch(url, {
              method: 'POST',
              headers: { 'accept': 'application/json' },
          });

          if (!response.ok) {
              const error = await response.json();
              console.error('Server responded with error:', error);
              alert(`Failed: ${error.detail || 'Unknown error'}`);
              return;
          }

          const result = await response.json();
          console.log('Success:', result);
          alert('Request was successful!');
      } catch (error) {
          console.error('Error sending request:', error);
          alert('Failed to send request. Check the console for more details.');
      }
  }
  
  // Function to generate a run UUID (you could replace it with a better approach if needed)
  function generateRunUuid() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = (Math.random() * 16) | 0;
        const v = c === 'x' ? r : (r & 0x3) | 0x8;
        return v.toString(16);
      });
    }
  

  

    
    

  
</script>

</body>
</html>
